# 第 14 题：如何实现一个 new

1. 新生成了一个对象
2. 链接到原型
3. 绑定 this
4. 返回新对象

```js
// 箭头函数
const _new = (fn, ...rest) => {
  const obj = Object.create(fn.prototype);
  const result = fn.apply(obj, rest);
  return result instanceof Object ? result : obj;
};

// arguments实现
const _new1 = function () {
  const obj = {};
  const constructor = Array.prototype.shift.call(arguments);
  obj.__proto__ = constructor.prototype;
  const result = constructor.apply(obj, [...arguments]);
  return result instanceof Object ? result : obj;
};

function a(name) {
  this.xx = name;
}

const xxx = _new(a, 23);
console.log('xxx: ', xxx);
```

# 模拟实现一个 Promise.finally

```js
Promise.prototype.finally = function (callback) {
  let P = this.constructor;
  return this.then(
    (value) => P.resolve(callback()).then(() => value),
    (reason) =>
      P.resolve(callback()).then(() => {
        throw reason;
      }),
  );
};
```

## 实现节流和防抖

### 节流

```js
const throttle = (fn, interval) => {
  let last = 0;
  return (...args) => {
    const now = +new Date();
    // 还没到时间
    if (now - last < interval) return;
    last = now;
    fn.apply(this, args);
  };
};
```

### 防抖

```js
const debounce = (fn, ms = 0) => {
  let timeoutId;
  return (...args) => {
    if (timeoutId) clearTimeout(timeoutId);
    timeoutId = setTimeout(() => fn.apply(this, args), ms);
  };
};
```

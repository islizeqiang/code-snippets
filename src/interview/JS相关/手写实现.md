# 第 14 题：如何实现一个 new

1. 新生成了一个对象
2. 链接到原型
3. 绑定 this
4. 返回新对象

```js
// 箭头函数
const _new = (fn, ...rest) => {
  const obj = Object.create(fn.prototype);
  const result = fn.apply(obj, rest);
  return result instanceof Object ? result : obj;
};

// arguments实现
const _new1 = function () {
  const obj = {};
  const constructor = Array.prototype.shift.call(arguments);
  obj.__proto__ = constructor.prototype;
  const result = constructor.apply(obj, [...arguments]);
  return result instanceof Object ? result : obj;
};

function a(name) {
  this.xx = name;
}

const xxx = _new(a, 23);
console.log('xxx: ', xxx);
```

# 模拟实现一个 Promise.finally

```js
Promise.prototype.finally = function (callback) {
  let P = this.constructor;
  return this.then(
    (value) => P.resolve(callback()).then(() => value),
    (reason) =>
      P.resolve(callback()).then(() => {
        throw reason;
      }),
  );
};
```

## 实现节流和防抖

### 节流

```js
const throttle = (fn, interval) => {
  let last = 0;
  return (...args) => {
    const now = +new Date();
    // 还没到时间
    if (now - last < interval) return;
    last = now;
    fn.apply(this, args);
  };
};
```

### 防抖

```js
const debounce = (fn, ms = 0) => {
  let timeoutId;
  return (...args) => {
    if (timeoutId) clearTimeout(timeoutId);
    timeoutId = setTimeout(() => fn.apply(this, args), ms);
  };
};
```

#### 实现 new

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>模拟new的过程</title>
    <link rel="stylesheet" href="" />
  </head>
  <body>
    <script type="text/javascript" charset="utf-8" async defer>
      function Person(name, age) {
        this.name = name;
        this.age = age;
      }

      //手动实现new
      function _new() {
        //1.拿到传入的参数中的第一个参数，即构造函数名Func
        var Func = [].shift.call(arguments);
        //2.创建一个空对象obj,并让其继承Func.prototype
        var obj = Object.create(Func.prototype);
        //第二步也可以这样写
        // var obj = {}
        // obj.__proto__ = Func.prototype
        //3.执行构造函数，并将this指向创建的空对象obj
        var ret = Func.apply(obj, arguments);
        //4.如果构造函数返回的值是对象则返回，不是对象则返回创建的对象obj
        return typeof ret === 'object' ? ret : obj;
      }

      var p1 = _new(Person, 'bob', 19);
      console.log(p1);
    </script>
  </body>
</html>
```
